/**
 * Created by Administrator on 2016/11/30.
 */$(document).ready(function(){function K(b){72===b.keyCode&&p(85,function(){p(65,function(){p(78,function(){p(71,function(){p(90,function(){p(72,function(){p(69,function(){p(78,function(){p(71,function(){p(72,function(){p(65,function(){p(79,function(){p(83,function(){p(72,function(){p(85,function(){p(65,function(){p(73,function(){L=!0})})})})})})})})})})})})})})})})})}function p(b,a){clearTimeout(U);window.onkeydown=function(d){d.keyCode===b&&(a(),U=setTimeout(function(){window.onkeydown=function(b){K(b)}},1E3))}}function ia(){var b=0,d=1;V=setInterval(function(){b+=-10;$("#main").stop().animate({backgroundPositionX:b+"px"},15);3>d?(a.body.css("backgroundPositionX",-52*d-8+"px"),d++):(d=1,a.body.css("backgroundPositionX","-8px"));A("bullet");A("light_bullet");A("enemy-bullet");A("boss1-bullet");A("shotgun");A("lightgun");A("eggItem");W("enemy1",y,-5,!0);W("enemy2",z,-3);ja();X("boss1-track1",-8,a.body[0]);X("boss1-track2",-8,a.body[0],!0);Y(y,1);Y(z,3);if(h){var l=Math.random();.02>l?ka():.06>l&&(.5>Math.random()?($(u).append("\x3cdiv class\x3d'boss1-track1'\x3e\x3c/div\x3e"),u.lastElementChild.style.left=h.body.offsetLeft+61+"px",u.lastElementChild.style.top=h.body.offsetTop+105+"px"):($(u).append("\x3cdiv class\x3d'boss1-track2'\x3e\x3c/div\x3e"),u.lastElementChild.style.left=h.body.offsetLeft+78+"px",u.lastElementChild.style.top=h.body.offsetTop+103+"px"));$("#bossHp")[0].value=h.HP;$(".bossHp").show();M(G(["bullet","light_bullet"],"boss1",function(){N&&(N=!1,h.HP-=a.power,$("#bossHp")[0].value=h.HP,0>=h.HP&&(t+=100,a.life++,O(),H++,B=0,$("#boss1").stop(!0).removeClass("boss1").addClass("boom").css("transform","scale(30)"),setTimeout(function(){$(".boom:last").remove()},300),h=null,$(".bossHp").hide(),setTimeout(function(){P=!0},1E4)),setTimeout(function(){N=!0},100*(H+1)))}))}M(G(["bullet","light_bullet"],"enemy1",function(){y[q].Hp-=a.power;0>=y[q].Hp&&Z("enemy1",q,1,y);q=null}));M(G(["bullet","light_bullet"],"enemy2",function(){z[q].Hp-=a.power;var b=Math.random();0>=z[q].Hp&&(.3>b?Q("shotgun",$(".enemy2:eq("+q+")")[0]):.8>b?Q("lightgun",$(".enemy2:eq("+q+")")[0]):Q("eggItem",$(".enemy2:eq("+q+")")[0]),Z("enemy2",q,5,z));q=null}));G(["bullet","light_bullet"],"boss1-track1");la();v.style.left=a.body[0].offsetLeft-8+"px";v.style.top=a.body[0].offsetTop-3+"px";a.skillTime?(C("enemy1",y),C("enemy2",z),C("enemy-bullet"),C("boss1-bullet"),C("boss1-track1"),C("boss1-track2")):(w("enemy1"),w("enemy2"),w("boss1"),w("enemy-bullet"),w("boss1-bullet"),w("boss1-track1"),w("boss1-track2"));w("shotgun",function(){5>a.bulletNum&&(a.bulletNum+=2,a.attackSpeed++);clearInterval(a.autoAttackTimer);a.autoAttackTimer=setInterval(a.attack,200*a.attackSpeed);a.power=1;a.lightHeight=4;a.lightWidth=15});w("lightgun",function(){8>a.lightHeight&&(a.lightHeight+=2);25>a.lightWidth&&(a.lightWidth+=5);clearInterval(a.autoAttackTimer);a.autoAttackTimer=setInterval(a.lightAttack,200);3>a.power&&a.power++;a.bulletNum=1;a.attackSpeed=1});w("eggItem",function(){$(".egg0")[0]?$(".egg1")[0]||(a.body.append("\x3cdiv class\x3d'egg egg1'\x3e\x3c/div\x3e"),ca=setInterval(function(){ba($(".egg1")[0])},1E3)):(a.body.append("\x3cdiv class\x3d'egg egg0'\x3e\x3c/div\x3e"),aa=setInterval(function(){ba($(".egg0")[0])},1E3))});t>window.localStorage.getItem("bird_hiScore")&&window.localStorage.setItem("bird_hiScore",t)},15)}function w(b,d,l){var f=document.getElementsByClassName(b);if(0<f.length)for(var e=0;e<f.length;e++)f[e].offsetLeft+f[e].offsetWidth>a.core[0].offsetLeft+a.body[0].offsetLeft&&f[e].offsetLeft<a.core[0].offsetLeft+a.body[0].offsetLeft+a.core[0].offsetWidth&&f[e].offsetTop+f[e].offsetHeight>a.core[0].offsetTop+a.body[0].offsetTop&&f[e].offsetTop<a.core[0].offsetTop+a.body[0].offsetTop+a.core[0].offsetHeight&&(d?($("."+b+":eq("+e+")").remove(),d()):a.skillTime?(/^boss[\d]$/.test(b)||$("."+b+":eq("+e+")").remove(),l&&l.splice(e,1),t++,I.innerHTML="\u5f97\u5206:"+t):0===a.life?(ma(),$(".mask p").html("\u4f60\u8fd9\u4e00\u6b21\u5171\u83b7\u5f97\u4e86:"+t+"\u5206").css("display","block"),$(".mask .start").html("\u91cd\u65b0\u5f00\u59cb")):($("."+b+":eq("+e+")").remove(),a.life--,O(),D=!0,clearInterval(F),da(),D=!0,clearInterval(F),x.clearRect(-25,-25,50,50),a.bulletNum=1,a.power=1,a.lightHeight=4,a.lightWidth=15,clearInterval(a.autoAttackTimer),a.autoAttackTimer=setInterval(a.attack,200),$(".egg").remove(),clearInterval(aa),clearInterval(ca)))}function da(){if(D){R&&clearTimeout(R);var b=0;a.skillTime=!0;D=!1;v.style.display="block";F=setInterval(function(){x.clearRect(-25,-25,50,50);667===b?(clearInterval(F),D=!0):(x.beginPath(),x.arc(0,0,25,(3*b-500)/1E3*Math.PI,3*Math.PI/2,!1),x.lineTo(0,0),x.closePath(),x.fill(),b++)},15);R=setTimeout(function(){a.skillTime=!1;v.style.display="none"},3E3)}}function O(){if(3<a.life)$(".life").html("\x3cdiv class\x3d'bird'\x3e\x3c/div\x3eX"+a.life);else{for(var b=[],d=1;d<=a.life;d++)b[d-1]="\x3cdiv class\x3d'bird'\x3e\x3c/div\x3e";$(".life").html(b.join(""))}}function ba(b){$($(m).append("\x3cdiv class\x3d'bullet'\x3e \x3c/div\x3e")[0].lastElementChild).css({left:b.offsetLeft+b.offsetWidth+a.body[0].offsetLeft+"px",top:a.body[0].offsetTop+b.offsetTop+b.offsetHeight/2+"px"});$(".bullet:last").attr("stepX",8)}function C(b,a){var d=document.getElementsByClassName(b);if(0<d.length)for(var f=0;f<d.length;f++)d[f].offsetLeft+d[f].offsetWidth>v.offsetLeft&&d[f].offsetLeft<v.offsetLeft+v.offsetWidth&&d[f].offsetTop+d[f].offsetHeight>v.offsetTop&&d[f].offsetTop<v.offsetTop+v.offsetHeight&&(/(track[\d])|(bullet)$/.test(b)?$("."+b+":eq("+f+")").remove():($("."+b+":eq("+f+")").stop(!0).removeClass(b).addClass("boom").css("transform","scale(3)"),setTimeout(function(){$(".boom:last").remove()},300)),t++,I.innerHTML="\u5f97\u5206:"+t,a&&a.splice(f,1))}function Z(b,a,l,f){$("."+b+":eq("+a+")").stop(!0).removeClass(b).addClass("boom").css("transform","scale(3)");setTimeout(function(){$(".boom:last").remove()},300);"enemy2"!==b&&($(r).append("\x3cdiv class\x3d'enemy-bullet'\x3e \x3c/div\x3e"),r.lastElementChild.setAttribute("stepY",-8*Math.sin(f[a].angle)),r.lastElementChild.setAttribute("stepX",-8*Math.cos(f[a].angle)),r.lastElementChild.style.left=f[a].body.offsetLeft+"px",r.lastElementChild.style.right=f[a].body.offsetRight+"px",r.lastElementChild.style.top=f[a].body.offsetTop+f[a].body.offsetHeight/2+"px");t+=l;I.innerHTML="\u5f97\u5206:"+t;f.splice(a,1)}function M(a){a&&g.push(a)}function la(){if(0<g.length)for(var a=0;a<g.length;a++)g[a][0].offsetLeft+g[a][0].offsetWidth>g[a][1].offsetLeft&&g[a][0].offsetLeft<g[a][1].offsetLeft+g[a][1].offsetWidth&&g[a][0].offsetTop+g[a][0].offsetHeight>g[a][1].offsetTop&&g[a][0].offsetTop<g[a][1].offsetTop+g[a][1].offsetHeight?(g[a][0].hit=!0,g[a][1].hit=!0):(g[a][0].hit=!1,g[a][1].hit=!1,g.splice(a,1))}function G(a,d,l){for(var b=[],e=0;e<a.length;e++)for(var c=m.getElementsByClassName(a[e]),k=0;k<c.length;k++)b[b.length]=c[k];c=document.getElementsByClassName(d);if(0<b.length)for(k=0;k<c.length;k++)for(var n=0;n<b.length;n++)if(b[n].offsetLeft+b[n].offsetWidth>c[k].offsetLeft&&b[n].offsetLeft<c[k].offsetLeft+c[k].offsetWidth&&b[n].offsetTop+b[n].offsetHeight>c[k].offsetTop&&b[n].offsetTop<c[k].offsetTop+c[k].offsetHeight&&(!b[n].hit||!c[k].hit))if(q=k,l)for(l(),e=0;e<a.length;e++){if(/^light/.test(a[e]))return b[n].hit=!0,c[k].hit=!0,[c[k],b[n]];$("."+a[e]+":eq("+n+")").remove()}else/track[\d]$/.test(d)&&$("."+d+":eq("+k+")").remove()}function W(b,d,l,f){for(var e=document.getElementsByClassName(b),c=0;c<e.length;c++){f?(d[c].angle=Math.atan((a.body[0].offsetTop-d[c].body.offsetTop)/(a.body[0].offsetLeft-d[c].body.offsetLeft)),e[c].stepX=l*Math.cos(d[c].angle),e[c].stepY=l*Math.sin(d[c].angle),a.body[0].offsetLeft>d[c].body.offsetLeft?(e[c].stepX=-e[c].stepX,e[c].stepY=-e[c].stepY,d[c].angle+=Math.PI,e[c].behind=!0):e[c].behind=!1):(e[c].stepX=l,e[c].stepY=0);var k=e[c].offsetLeft,n=e[c].offsetTop,k=k+e[c].stepX,n=n+e[c].stepY;$(e[c]).css({left:k+"px",top:n+"px",transform:"rotate("+180*d[c].angle/Math.PI+"deg)"});(0>=e[c].offsetTop||e[c].offsetTop>=m.offsetHeight-e[c].offsetHeight)&&$("."+b+":eq("+c+")").css("top",m.offsetHeight/2+"px");0>=e[c].offsetLeft&&($("."+b+":eq("+c+")").remove(),d.splice(c,1))}}function ea(a,d){this.x=m.offsetWidth;this.y=Math.ceil(Math.random()*(m.offsetHeight-44));var b="\x3cdiv class\x3d"+a+"\x3e \x3c/div\x3e";$($(fa).append(b)[0].lastElementChild).css({left:this.x+"px",top:this.y+"px"});this.body=fa.lastElementChild;this.Hp=d*H;this.behind=!1;this.angle=0;this.valve=!0;this.hit=!1}function Y(a,d){for(var b=0;b<a.length;b++)if(a[b].valve&&.03>Math.random()){a[b].valve=!1;for(var f=0;f<d;f++)$(r).append("\x3cdiv class\x3d'enemy-bullet'\x3e \x3c/div\x3e"),a[b].behind?(r.lastElementChild.style.left=a[b].body.offsetLeft+(1+Math.cos(a[b].angle))*a[b].body.offsetWidth/2+"px",r.lastElementChild.setAttribute("stepX",8*Math.cos(a[b].angle))):(r.lastElementChild.style.left=a[b].body.offsetLeft+(1-Math.cos(a[b].angle))*a[b].body.offsetWidth/2+"px",r.lastElementChild.setAttribute("stepX",-8*Math.cos(a[b].angle))),r.lastElementChild.style.top=a[b].body.offsetTop+(1-Math.sin(a[b].angle))*a[b].body.offsetHeight/2+"px",r.lastElementChild.setAttribute("stepY",5*Math.sin((f-Math.floor(d/2))*Math.PI/d*4)),1===d&&r.lastElementChild.setAttribute("stepY",-8*Math.sin(a[b].angle));(function(b){setTimeout(function(){a[b]&&(a[b].valve=!0)},1E3)})(b)}}function A(a){a=document.getElementsByClassName(a);for(var b=0;b<a.length;b++){var l=Number(a[b].getAttribute("stepX")),f=Number(a[b].getAttribute("stepY")),e=a[b].offsetLeft,e=e+l;e>=m.offsetWidth-a[b].offsetWidth||0>=e?$(a).parent()[0].removeChild(a[b]):a[b].style.left=e+"px";f&&(l=a[b].offsetTop,l+=f,l>=m.offsetHeight-a[b].offsetHeight||0>=l?$(a).parent()[0].removeChild(a[b]):a[b].style.top=l+"px")}}function ga(){for(var a=0;a<3+B%5;a++){var d=new ea("enemy1",1);y.push(d)}for(a=0;a<B/5;a++)d=new ea("enemy2",5),z.push(d);ha=setTimeout(function(){B++;!h&&0===B%5&&P&&(h=new na,P=!1);ga()},5E3)}function na(){$(oa).append("\x3cdiv id\x3d'boss1' class\x3d'boss1'\x3e \x3c/div\x3e");this.HP=100;this.tamp=!0;this.body=document.getElementById("boss1");this.hit=!1;$(".bossHp").show()}function ja(){var a=document.getElementById("boss1");a&&(.1>Math.random()&&h.tamp&&($(a).addClass("rotate"),h.tamp=!1,setTimeout(function(){$(a).removeClass("rotate");h.tamp=!0},3E3)),50>a.offsetTop?S=3:400<a.offsetTop&&(S=-3),$(a).css("top",a.offsetTop+Math.random()*S+"px"))}function ka(){if(T){for(var a=2;9>a;a++)$(u).append("\x3cdiv class\x3d'boss1-bullet'\x3e\x3c/div\x3e"),u.lastElementChild.style.left=h.body.offsetLeft+73+"px",u.lastElementChild.style.top=h.body.offsetTop+112+"px",u.lastElementChild.setAttribute("stepY",8*Math.sin((a-5)*Math.PI/11)),u.lastElementChild.setAttribute("stepX",-8*Math.cos((a-5)*Math.PI/11));T=!1;setTimeout(function(){T=!0},1E3)}}function X(a,d,l,f){a=document.getElementsByClassName(a);var b=l.offsetLeft;l=l.offsetTop;for(var c=0;c<a.length;c++){var k=a[c].offsetLeft,n=a[c].offsetTop,g=Math.atan((l-n)/(b-k)),h=d*Math.cos(g),g=d*Math.sin(g),h=0>h?Math.floor(h):Math.ceil(h),g=0>g?Math.floor(g):Math.ceil(g);b>k&&(h=-h,g=-g);f&&(E[c]?E[c]++:E[c]=1,50>E[c]?J[c]={StepX:h,StepY:g}:(h=J[c].StepX,g=J[c].StepY));k+=h;n+=g;k>=m.offsetWidth-a[c].offsetWidth||0>=k||n>=m.offsetHeight-a[c].offsetHeight||0>=n?(E.splice(c,1),$(a).parent()[0].removeChild(a[c])):(a[c].style.left=k+"px",a[c].style.top=n+"px")}}function Q(a,d){$(pa).append("\x3cdiv class\x3d"+a+"\x3e\x3c/div\x3e");$("."+a+":last").css({left:d.offsetLeft+"px",top:d.offsetTop+"px"})[0].setAttribute("stepX",-8)}function ma(){clearInterval(a.timer);clearInterval(V);clearTimeout(ha);clearTimeout(a.autoAttackTimer);clearInterval(F);$(".enemy1").stop(!0);$(".enemy2").stop(!0);$(".mask").show();$("#main").stop(!0).off();$("body").off();$("#bird").stop(!0);L=!1;window.onkeydown=function(a){K(a)};$(".hiScore").html("\u4f60\u76ee\u524d\u7684\u6700\u9ad8\u5206\u662f"+window.localStorage.getItem("bird_hiScore"))}var m=document.getElementById("main");m.style.height=document.documentElement.clientHeight+"px";var fa=document.getElementById("enemy"),r=document.getElementById("enemy-bullet"),oa=document.getElementById("boss"),u=document.getElementById("boss-bullet"),pa=document.getElementById("item"),v=document.getElementById("skill"),V=null,ha=null,t=0,I=$(".score")[0],F=null,aa=null,ca=null,a={body:$("#bird"),speed:10,life:3,core:$("#core"),timer:null,moveTargetX:null,moveTargetY:null,moveLeaderX:null,moveLeaderY:null,stepX:null,stepY:null,move:function(b){a.moveTargetX=b.clientX-m.offsetLeft-17;a.moveTargetY=b.clientY-m.offsetTop-12;0>=b.clientX-m.offsetLeft-17&&(a.moveTargetX=0);0>=b.clientY-m.offsetTop-12&&(a.moveTargetY=0);b.clientX-m.offsetLeft-17>=m.offsetWidth-a.body[0].offsetWidth&&(a.moveTargetX=m.offsetWidth-a.body[0].offsetWidth);b.clientY-m.offsetTop-12>=m.offsetHeight-a.body[0].offsetHeight&&(a.moveTargetY=m.offsetHeight-a.body[0].offsetHeight);a.moveLeaderX=a.body[0].offsetLeft;a.moveLeaderY=a.body[0].offsetTop;b=Math.atan((a.moveTargetY-a.moveLeaderY)/(a.moveTargetX-a.moveLeaderX));a.stepX=a.speed*Math.cos(b);a.stepY=a.speed*Math.sin(b);a.stepX=0>a.stepX?Math.floor(a.stepX):Math.ceil(a.stepX);a.stepY=0>a.stepY?Math.floor(a.stepY):Math.ceil(a.stepY);a.moveTargetX<a.moveLeaderX&&(a.stepX=-a.stepX,a.stepY=-a.stepY);a.moveLeaderX+=a.stepX;a.moveLeaderY+=a.stepY;a.body[0].style.left=a.moveLeaderX+"px";a.body[0].style.top=a.moveLeaderY+"px"},attackSpeed:1,attack:function(){for(var b=0;b<a.bulletNum;b++)$($(m).append("\x3cdiv class\x3d'bullet'\x3e \x3c/div\x3e")[0].lastElementChild).css({left:a.body[0].offsetLeft+a.body[0].offsetWidth+"px",top:a.body[0].offsetTop+a.body[0].offsetHeight/2+"px"}),$(".bullet:last").attr({stepY:3*Math.sin((b-Math.floor(a.bulletNum/2))*Math.PI/a.bulletNum),stepX:8})},autoAttackTimer:null,bulletNum:1,skillTime:!1,lightAttack:function(){$($(m).append("\x3cdiv class\x3d'light_bullet'\x3e \x3c/div\x3e")[0].lastElementChild).css({left:a.body[0].offsetLeft+a.body[0].offsetWidth+"px",top:a.body[0].offsetTop+a.body[0].offsetHeight/2+"px",width:a.lightWidth+"px",height:a.lightHeight+"px"});$(".light_bullet:last").attr({stepX:"8",hit:!1})},power:1,lightWidth:15,lightHeight:4};$(".mask").css({width:document.documentElement.clientWidth,height:document.documentElement.clientHeight});var L=!1,U=!1;window.onkeydown=function(a){K(a)};var D=!0;window.localStorage.getItem("bird_hiScore")||window.localStorage.setItem("bird_hiScore",0);$(".hiScore").html("\u4f60\u76ee\u524d\u7684\u6700\u9ad8\u5206\u662f"+window.localStorage.getItem("bird_hiScore"));$(".delete").on("click",function(){window.localStorage.removeItem("bird_hiScore");$(".hiScore").html("\u4f60\u7684\u5b58\u6863\u5df2\u7ecf\u5220\u9664\u6210\u529f.\x3cbr/\x3e\u518d\u6b21\u6253\u5f00\u672c\u9875\u9762,\u6216\u8fdb\u884c\u4e00\u6b21\u6e38\u620f\u540e,\u4f1a\u518d\u6b21\u751f\u6210\u5b58\u6863\u6570\u636e")});$(".mask .start").on("click",function(){$(".mask").hide();$(".bullet").remove();$(".light_bullet").remove();$(".enemy1").remove();$(".enemy2").remove();$(".boss1").remove();$(".enemy-bullet").remove();$(".boss1-bullet").remove();$(".boss1-track1").remove();$(".boss1-track2").remove();$(".shotgun").remove();$(".bossHp").hide();a.bulletNum=1;a.power=1;a.lightHeight=4;a.lightWidth=15;h=null;y=[];z=[];t=B=0;J=[];E=[];H=0;D=!0;x.clearRect(-25,-25,50,50);L?a.life=30:a.life=3;O();window.onkeydown=null;I.innerHTML="\u5f97\u5206:"+t;$("body").on({mousemove:function(b){clearInterval(a.timer);a.move(b);a.timer=setInterval(function(){a.move(b);Math.abs(a.moveLeaderX-a.moveTargetX)<Math.abs(a.stepX)&&Math.abs(a.moveLeaderY-a.moveTargetY)<Math.abs(a.stepY)&&(a.body[0].style.left=a.moveTargetX+"px",a.body[0].style.top=a.moveTargetY+"px",clearInterval(a.timer))},15)},keydown:da});a.autoAttackTimer=setInterval(a.attack,200*a.attackSpeed);ia();ga()});var R=null,x=document.getElementById("coldTimer").getContext("2d");x.translate(25,25);x.fillStyle="rgba(0, 0, 0, .3)";var g=[],q=null,N=!0,y=[],z=[],B=0,P=!0,H=1,h=null,S=3,T=!0,J=[],E=[]});